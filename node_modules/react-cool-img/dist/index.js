"use strict";var e,r=require("react"),t=(e=r)&&"object"==typeof e&&"default"in e?e.default:e;function n(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function i(){return(i=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function c(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function l(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var t=[],n=!0,o=!1,i=void 0;try{for(var c,l=e[Symbol.iterator]();!(n=(c=l.next()).done)&&(t.push(c.value),!r||t.length!==r);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==l.return||l.return()}finally{if(o)throw i}}return t}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var s="REACT_COOL_IMG",u=function(){function e(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"img",null),o(this,"timeout",null),o(this,"retries",1)}var r,t,i;return r=e,(t=[{key:"load",value:function(e,r,t,n,o,i){var c=this,l=n.count,s=void 0===l?3:l,u=n.delay,a=void 0===u?2:u,f=n.acc,m=void 0===f?"*":f;this.img=new Image,this.img.src=e,r&&(this.img.crossOrigin=r),t&&this.img.decode().catch((function(){})),this.img.onerror=function(r){if(!s||c.retries>s)o(r);else{var t="*"===m?Math.pow(a,c.retries):a*c.retries;!1===m&&(t=a),c.timeout=setTimeout((function(){c.clearImgSrc(),c.img.src=e}),1e3*t),c.retries+=1}},this.img.onload=function(e){i(e)}}},{key:"unload",value:function(){this.img&&(this.img.onerror=null,this.img.onload=null,this.clearImgSrc(),this.img=null),this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.retries=1}},{key:"clearImgSrc",value:function(){this.img.src="";try{delete this.img.src}catch(e){}}}])&&n(r.prototype,t),i&&n(r,i),e}(),a=function(e){var n=e.className,o=e.placeholder,a=e.src,f=e.error,m=e.crossOrigin,g=e.decode,h=e.lazy,d=e.cache,p=e.debounce,y=e.observerOptions,b=e.retry,v=e.srcSet,O=e.sizes,A=e.onError,w=e.onLoad,S=c(e,["className","placeholder","src","error","crossOrigin","decode","lazy","cache","debounce","observerOptions","retry","srcSet","sizes","onError","onLoad"]),E=r.useRef(new u).current,I=function(e,t){var n=t.root,o=void 0===n?null:n,i=t.rootMargin,c=void 0===i?"50px":i,s=t.threshold,u=void 0===s?.01:s,a=function(){return null},f=[a,!0,a];if("undefined"==typeof window)return f;if(!window.IntersectionObserver)return console.error("ðŸ’¡react-cool-img: this browser doesn't support IntersectionObserver, please install polyfill to enable lazy loading. More info: https://github.com/wellyshen/react-cool-img#intersectionobserver-polyfill"),f;var m=l(r.useState(!1),2),g=m[0],h=m[1],d=l(r.useState(null),2),p=d[0],y=d[1],b=r.useRef(null),v=r.useRef(null),O=u;"number"!=typeof u&&(console.error("ðŸ’¡react-cool-img: the threshold of observerOptions must be a number. Use 0 as fallback."),O=0);var A=r.useCallback((function(){v.current&&(clearTimeout(v.current),v.current=null)}),[]);return r.useEffect((function(){b.current&&b.current.disconnect(),b.current=new IntersectionObserver((function(r){l(r,1)[0].isIntersecting&&!g?v.current=setTimeout((function(){h(!0)}),e):A()}),{root:o,rootMargin:c,threshold:O});var r=b.current;return p&&r.observe(p),function(){r.disconnect(),A()}}),[p,g,o,c,O,e]),[y,g,h]}(p,y),j=l(I,2),z=j[0],N=j[1],k=l(r.useState(o||"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="),2),P=k[0],T=k[1],C=P===a,R=a?a.replace(/^.*[\\/]/,"").split(".")[0]:"",x=function(e){A(e),f?T(f):o&&T(o)},L=function(e){w(e),T(a),d&&function(e){try{var r=JSON.parse(sessionStorage.getItem(s))||{};r[e]=new Date,sessionStorage.setItem(s,JSON.stringify(r))}catch(e){console.error("ðŸ’¡react-cool-img: ".concat(e))}}(a)};return r.useEffect((function(){var e=function(){E.load(a,m,g,b,x,L)};return!h||d&&function(e){try{return!!(JSON.parse(sessionStorage.getItem(s))||{})[e]||!1}catch(e){return console.error("ðŸ’¡react-cool-img: ".concat(e)),!1}}(a)?e():N&&e(),function(){E.unload()}}),[d,N,a,m,g,b]),t.createElement(t.Fragment,null,t.createElement("img",i({className:"".concat(n," no-js-").concat(R),src:P,crossOrigin:C?m:null,srcSet:C?v:null,sizes:C?O:null,ref:z},S)),t.createElement("noscript",null,t.createElement("style",null,".no-js-".concat(R," { display: none !important; }")),t.createElement("img",i({className:n,src:a,crossOrigin:m,srcSet:v,sizes:O},S))))};a.defaultProps={className:"",placeholder:null,error:null,crossOrigin:null,decode:!0,lazy:!0,cache:!0,debounce:300,observerOptions:{},retry:{},srcSet:null,sizes:null,onError:function(){return null},onLoad:function(){return null}};var f=r.memo(a);module.exports=f;
