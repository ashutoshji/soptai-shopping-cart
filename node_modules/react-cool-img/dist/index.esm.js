import e,{useState as r,useRef as t,useCallback as n,useEffect as o,memo as i}from"react";function c(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(){return(s=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function a(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function u(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var t=[],n=!0,o=!1,i=void 0;try{for(var c,l=e[Symbol.iterator]();!(n=(c=l.next()).done)&&(t.push(c.value),!r||t.length!==r);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==l.return||l.return()}finally{if(o)throw i}}return t}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var f="REACT_COOL_IMG",m=function(){function e(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),l(this,"img",null),l(this,"timeout",null),l(this,"retries",1)}var r,t,n;return r=e,(t=[{key:"load",value:function(e,r,t,n,o,i){var c=this,l=n.count,s=void 0===l?3:l,a=n.delay,u=void 0===a?2:a,f=n.acc,m=void 0===f?"*":f;this.img=new Image,this.img.src=e,r&&(this.img.crossOrigin=r),t&&this.img.decode().catch((function(){})),this.img.onerror=function(r){if(!s||c.retries>s)o(r);else{var t="*"===m?Math.pow(u,c.retries):u*c.retries;!1===m&&(t=u),c.timeout=setTimeout((function(){c.clearImgSrc(),c.img.src=e}),1e3*t),c.retries+=1}},this.img.onload=function(e){i(e)}}},{key:"unload",value:function(){this.img&&(this.img.onerror=null,this.img.onload=null,this.clearImgSrc(),this.img=null),this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.retries=1}},{key:"clearImgSrc",value:function(){this.img.src="";try{delete this.img.src}catch(e){}}}])&&c(r.prototype,t),n&&c(r,n),e}(),g=function(i){var c=i.className,l=i.placeholder,g=i.src,h=i.error,d=i.crossOrigin,p=i.decode,y=i.lazy,v=i.cache,b=i.debounce,O=i.observerOptions,A=i.retry,w=i.srcSet,S=i.sizes,I=i.onError,E=i.onLoad,j=a(i,["className","placeholder","src","error","crossOrigin","decode","lazy","cache","debounce","observerOptions","retry","srcSet","sizes","onError","onLoad"]),z=t(new m).current,N=function(e,i){var c=i.root,l=void 0===c?null:c,s=i.rootMargin,a=void 0===s?"50px":s,f=i.threshold,m=void 0===f?.01:f,g=function(){return null},h=[g,!0,g];if("undefined"==typeof window)return h;if(!window.IntersectionObserver)return console.error("ðŸ’¡react-cool-img: this browser doesn't support IntersectionObserver, please install polyfill to enable lazy loading. More info: https://github.com/wellyshen/react-cool-img#intersectionobserver-polyfill"),h;var d=u(r(!1),2),p=d[0],y=d[1],v=u(r(null),2),b=v[0],O=v[1],A=t(null),w=t(null),S=m;"number"!=typeof m&&(console.error("ðŸ’¡react-cool-img: the threshold of observerOptions must be a number. Use 0 as fallback."),S=0);var I=n((function(){w.current&&(clearTimeout(w.current),w.current=null)}),[]);return o((function(){A.current&&A.current.disconnect(),A.current=new IntersectionObserver((function(r){u(r,1)[0].isIntersecting&&!p?w.current=setTimeout((function(){y(!0)}),e):I()}),{root:l,rootMargin:a,threshold:S});var r=A.current;return b&&r.observe(b),function(){r.disconnect(),I()}}),[b,p,l,a,S,e]),[O,p,y]}(b,O),P=u(N,2),T=P[0],k=P[1],x=u(r(l||"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="),2),C=x[0],L=x[1],M=C===g,B=g?g.replace(/^.*[\\/]/,"").split(".")[0]:"",J=function(e){I(e),h?L(h):l&&L(l)},R=function(e){E(e),L(g),v&&function(e){try{var r=JSON.parse(sessionStorage.getItem(f))||{};r[e]=new Date,sessionStorage.setItem(f,JSON.stringify(r))}catch(e){console.error("ðŸ’¡react-cool-img: ".concat(e))}}(g)};return o((function(){var e=function(){z.load(g,d,p,A,J,R)};return!y||v&&function(e){try{return!!(JSON.parse(sessionStorage.getItem(f))||{})[e]||!1}catch(e){return console.error("ðŸ’¡react-cool-img: ".concat(e)),!1}}(g)?e():k&&e(),function(){z.unload()}}),[v,k,g,d,p,A]),e.createElement(e.Fragment,null,e.createElement("img",s({className:"".concat(c," no-js-").concat(B),src:C,crossOrigin:M?d:null,srcSet:M?w:null,sizes:M?S:null,ref:T},j)),e.createElement("noscript",null,e.createElement("style",null,".no-js-".concat(B," { display: none !important; }")),e.createElement("img",s({className:c,src:g,crossOrigin:d,srcSet:w,sizes:S},j))))};g.defaultProps={className:"",placeholder:null,error:null,crossOrigin:null,decode:!0,lazy:!0,cache:!0,debounce:300,observerOptions:{},retry:{},srcSet:null,sizes:null,onError:function(){return null},onLoad:function(){return null}};var h=i(g);export default h;
